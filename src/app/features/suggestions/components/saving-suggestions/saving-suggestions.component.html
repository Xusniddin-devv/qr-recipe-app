@if (isLoading) {
<app-loading-indicator
  message="Getting saving suggestions..."
></app-loading-indicator>
} @else if (error) {
<div
  class="grid p-4 my-4 bg-red-100 text-red-700 rounded-md place-items-center text-center"
>
  <p>Error: {{ error }}</p>
  @if (error === 'OpenRouter API key is not configured.' ||
  error.includes('Unauthorized')) {
  <p>Please ensure the OpenRouter API key is correctly set.</p>
  }
</div>
} @else if (!suggestions) { @if (hasProducts) {
<app-empty-state
  icon="analysis"
  title="Analyzing your purchases for saving opportunities..."
  description="Suggestions will appear here shortly."
></app-empty-state>
} @else {
<app-empty-state
  icon="receipt-missing"
  title="No receipt data to analyze."
  description="Scan a receipt first to get saving suggestions."
></app-empty-state>
} } @else if (!hasSavingContent()) {
<div
  class="grid grid-cols-[auto_1fr] gap-2 items-center p-6 bg-white rounded-lg shadow-sm"
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="h-6 w-6 text-orange-500"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
    />
  </svg>
  <span class="text-gray-600 text-sm"
    >No saving suggestions available for these items.</span
  >
</div>
} @else {
<!-- Budget Analysis Summary -->
@if (getBudgetAnalysis(); as budget) {
<div
  class="mb-6 p-4 bg-gradient-to-r from-orange-50 to-yellow-50 rounded-lg border border-orange-200"
>
  <h3
    class="text-lg font-semibold mb-3 text-orange-800 flex items-center gap-2"
  >
    <span>ðŸ“Š</span>
    Budget Analysis
  </h3>
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
    <div class="text-center">
      <div class="font-bold text-orange-700">
        {{ formatCurrency(budget.totalSpent) }}
      </div>
      <div class="text-orange-600">Total Spent</div>
    </div>
    <div class="text-center">
      <div class="font-bold text-orange-700">
        {{ formatCurrency(budget.averageItemPrice) }}
      </div>
      <div class="text-orange-600">Avg. Item Price</div>
    </div>
    <div class="text-center">
      <div class="font-bold text-green-700">
        {{ budget.costEffectiveItems.length }}
      </div>
      <div class="text-green-600">Budget-Friendly</div>
    </div>
    <div class="text-center">
      <div class="font-bold text-red-700">
        {{ budget.expensiveItems.length }}
      </div>
      <div class="text-red-600">Premium Items</div>
    </div>
  </div>

  @if (budget.costEffectiveItems.length > 0) {
  <div class="mt-3 p-2 bg-green-50 rounded border border-green-200">
    <div class="text-sm font-medium text-green-800">Best Value Items:</div>
    <div class="text-sm text-green-700">
      {{ budget.costEffectiveItems.join(", ") }}
    </div>
  </div>
  } @if (budget.expensiveItems.length > 0) {
  <div class="mt-3 p-2 bg-red-50 rounded border border-red-200">
    <div class="text-sm font-medium text-red-800">Premium Items:</div>
    <div class="text-sm text-red-700">
      {{ budget.expensiveItems.join(", ") }}
    </div>
  </div>
  }
</div>
}

<!-- Saving Suggestions Sections -->
@for (section of getSavingSections(); track section.title) {
<div class="ai-suggestions-section mb-6">
  <h3
    class="section-title text-lg sm:text-xl font-semibold mb-3 flex items-center gap-2"
    [ngClass]="{
      'text-orange-700': section.color === 'orange',
      'text-purple-700': section.color === 'purple'
    }"
  >
    <span>{{ section.icon }}</span>
    {{ section.title }}
  </h3>
  <div class="grid gap-3">
    @for (item of section.items; track $index) {
    <div
      class="p-4 bg-white rounded-lg shadow-sm border-l-4 transition-all hover:shadow-md"
      [ngClass]="{
        'border-orange-500': section.color === 'orange',
        'border-purple-500': section.color === 'purple'
      }"
      [innerHTML]="item | markdown"
    ></div>
    }
  </div>
</div>
} }
