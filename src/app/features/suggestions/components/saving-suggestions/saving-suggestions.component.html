@if (isLoading) {
<app-loading-indicator
  message="Getting saving suggestions..."
></app-loading-indicator>
} @else if (error) {
<div
  class="grid p-4 my-4 bg-red-500/10 text-red-300 border border-red-500/30 rounded-md place-items-center text-center"
>
  <p class="font-semibold">Error: {{ error }}</p>
  @if (error === 'OpenRouter API key is not configured.' ||
  error.includes('Unauthorized')) {
  <p class="text-sm mt-1">
    Please ensure the OpenRouter API key is correctly set.
  </p>
  }
</div>
} @else if (!suggestions) { @if (hasProducts) {
<app-empty-state
  icon="analysis"
  title="Analyzing your purchases for saving opportunities..."
  description="Suggestions will appear here shortly."
></app-empty-state>
} @else {
<app-empty-state
  icon="receipt-missing"
  title="No receipt data to analyze."
  description="Scan a receipt first to get saving suggestions."
></app-empty-state>
} } @else if (!hasSavingContent()) {
<div
  class="grid grid-cols-[auto_1fr] gap-4 items-center p-6 bg-slate-800 rounded-lg shadow-md"
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="h-6 w-6 text-orange-400"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
    />
  </svg>
  <span class="text-slate-300 text-sm"
    >No specific saving suggestions available for these items.</span
  >
</div>
} @else {
<!-- Budget Analysis Summary -->
@if (getBudgetAnalysis(); as budget) {
<div class="mb-6 p-4 bg-slate-800 rounded-lg border border-slate-700">
  <h3
    class="text-lg font-semibold mb-4 text-orange-300 flex items-center gap-2"
  >
    <span>ðŸ“Š</span>
    Budget Analysis
  </h3>
  <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
    <div class="text-center p-3 bg-slate-700/50 rounded-lg">
      <div class="font-bold text-lg text-orange-300">
        {{ formatCurrency(budget.totalSpent) }}
      </div>
      <div class="text-orange-400">Total Spent</div>
    </div>
    <div class="text-center p-3 bg-slate-700/50 rounded-lg">
      <div class="font-bold text-lg text-orange-300">
        {{ formatCurrency(budget.averageItemPrice) }}
      </div>
      <div class="text-orange-400">Avg. Item Price</div>
    </div>
    <div class="text-center p-3 bg-slate-700/50 rounded-lg">
      <div class="font-bold text-lg text-green-400">
        {{ budget.costEffectiveItems.length }}
      </div>
      <div class="text-green-400">Budget-Friendly</div>
    </div>
    <div class="text-center p-3 bg-slate-700/50 rounded-lg">
      <div class="font-bold text-lg text-red-400">
        {{ budget.expensiveItems.length }}
      </div>
      <div class="text-red-400">Premium Items</div>
    </div>
  </div>

  @if (budget.costEffectiveItems.length > 0) {
  <div class="mt-4 p-3 bg-green-500/10 rounded-lg border border-green-500/20">
    <div class="text-sm font-medium text-green-300 mb-2">Best Value Items:</div>
    <ul class="text-sm text-green-200 space-y-1 list-disc list-inside">
      @for(item of budget.costEffectiveItems; track item) {
      <li>{{ item }}</li>
      }
    </ul>
  </div>
  } @if (budget.expensiveItems.length > 0) {
  <div class="mt-3 p-3 bg-red-500/10 rounded-lg border border-red-500/20">
    <div class="text-sm font-medium text-red-300 mb-2">Premium Items:</div>
    <ul class="text-sm text-red-200 space-y-1 list-disc list-inside">
      @for(item of budget.expensiveItems; track item) {
      <li>{{ item }}</li>
      }
    </ul>
  </div>
  }
</div>
}

<!-- Saving Suggestions Sections -->
@for (section of getSavingSections(); track section.title) {
<div class="ai-suggestions-section mb-6">
  <h3
    class="section-title text-lg sm:text-xl font-semibold mb-3 flex items-center gap-2"
    [ngClass]="{
      'text-orange-400': section.color === 'orange',
      'text-purple-400': section.color === 'purple'
    }"
  >
    <span>{{ section.icon }}</span>
    {{ section.title }}
  </h3>
  <div class="grid gap-3">
    @for (item of section.items; track $index) {
    <div
      class="p-4 bg-slate-800 rounded-lg shadow-md border-l-4 transition-all hover:bg-slate-700/50 prose prose-invert max-w-none prose-p:text-slate-300 prose-ul:text-slate-300 prose-strong:text-white"
      [ngClass]="{
        'border-orange-500': section.color === 'orange',
        'border-purple-500': section.color === 'purple'
      }"
      [innerHTML]="item | markdown"
    ></div>
    }
  </div>
</div>
} }
