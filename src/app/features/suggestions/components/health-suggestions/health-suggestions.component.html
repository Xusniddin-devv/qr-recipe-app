@if (isLoading) {
<app-loading-indicator
  message="Getting health insights..."
></app-loading-indicator>
} @else if (error) {
<div
  class="grid p-4 my-4 bg-red-500/10 text-red-300 border border-red-500/30 rounded-md place-items-center text-center"
>
  <p class="font-semibold">Error: {{ error }}</p>
  @if (error === 'OpenRouter API key is not configured.' ||
  error.includes('Unauthorized')) {
  <p class="text-sm mt-1">
    Please ensure the OpenRouter API key is correctly set.
  </p>
  }
</div>
} @else if (!suggestions) { @if (hasProducts) {
<app-empty-state
  icon="analysis"
  title="Analyzing your items for health insights..."
  description="Health suggestions will appear here shortly."
></app-empty-state>
} @else {
<app-empty-state
  icon="receipt-missing"
  title="No receipt data to analyze."
  description="Scan a receipt first to get AI-powered health suggestions."
></app-empty-state>
} } @else if (!hasHealthContent()) {
<div
  class="grid grid-cols-[auto_1fr] gap-4 items-center p-6 bg-slate-800 rounded-lg shadow-md"
>
  <svg
    xmlns="http://www.w3.org/2000/svg"
    class="h-6 w-6 text-green-400"
    fill="none"
    viewBox="0 0 24 24"
    stroke="currentColor"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
    />
  </svg>
  <span class="text-slate-300 text-sm"
    >No specific health suggestions available for these items.</span
  >
</div>
} @else { @for (section of getHealthSections(); track section.title) {
<div class="ai-suggestions-section mb-6">
  <h3
    class="section-title text-lg sm:text-xl font-semibold mb-3 flex items-center gap-2"
    [ngClass]="{
      'text-green-400': section.color === 'green',
      'text-blue-400': section.color === 'blue'
    }"
  >
    <span>{{ section.icon }}</span>
    {{ section.title }}
  </h3>
  <div class="grid gap-3">
    @for (item of section.items; track $index) {
    <div
      class="p-4 bg-slate-800 rounded-lg shadow-md border-l-4 transition-all hover:bg-slate-700/50 prose prose-invert max-w-none prose-p:text-slate-300 prose-ul:text-slate-300 prose-strong:text-white"
      [ngClass]="{
        'border-green-500': section.color === 'green',
        'border-blue-500': section.color === 'blue'
      }"
      [innerHTML]="item | markdown"
    ></div>
    }
  </div>
</div>
} }
