@if(streamActive){
<div
  class="fixed inset-0 w-screen h-screen bg-black overflow-hidden block z-40 md:relative md:inset-auto md:w-full md:max-w-xl lg:max-w-2xl md:aspect-[16/9] md:mx-auto md:my-4 md:rounded-lg md:z-auto"
>
  <video
    #video
    class="w-full h-full object-cover block"
    playsinline
    muted
  ></video>
  <canvas #canvas class="hidden"></canvas>
  <div
    class="absolute w-6 h-6 border-4 border-white top-[35%] left-[25%] border-r-0 border-b-0"
  ></div>
  <div
    class="absolute w-6 h-6 border-4 border-white top-[35%] right-[25%] border-l-0 border-b-0"
  ></div>
  <div
    class="absolute w-6 h-6 border-4 border-white bottom-[35%] left-[25%] border-r-0 border-t-0"
  ></div>
  <div
    class="absolute w-6 h-6 border-4 border-white bottom-[35%] right-[25%] border-l-0 border-t-0"
  ></div>

  @if(status){
  <div
    class="absolute bottom-40 left-1/2 -translate-x-1/2 z-50 px-6 py-3 text-center font-semibold transition-all duration-300 ease-in-out border-2 border-transparent rounded-xl w-auto max-w-[90%] backdrop-blur-sm shadow-lg"
    [ngClass]="{
      'bg-emerald-500/90 text-white border-emerald-400/50 animate-pulse shadow-emerald-500/25':
        decodedUrl !== null && !hasError,
      'bg-red-500/90 text-white border-red-400/50 shadow-red-500/25': hasError
    }"
  >
    {{ status }}
  </div>
  }

  <button
    class="absolute bottom-16 left-1/2 -translate-x-1/2 bg-black/50 border-none p-3 rounded-full text-2xl text-white cursor-pointer z-50"
    (click)="toggleTorch()"
  >
    <span [class]="torchOn ? 'text-[gold]' : ''"
      ><img class="size-8" src="assets/flashlight.png" alt=""
    /></span>
  </button>
</div>
} @else {
<div
  class="p-5 bg-gradient-to-b from-slate-100 to-slate-200 min-h-[calc(100vh-8rem)]"
>
  <!-- Camera container as a button -->
  <button
    (click)="startScanner()"
    class="w-full mx-auto flex flex-col items-center focus:outline-none cursor-pointer"
  >
    <div
      class="w-full aspect-square max-w-md bg-slate-200/60 border border-dashed border-slate-300 rounded-lg flex items-center justify-center shadow-inner"
    >
      <div class="text-slate-400">
        <i class="pi pi-camera text-6xl"></i>
      </div>
    </div>
  </button>
  <p class="text-slate-500 text-center mt-2">
    Align the QR code on your receipt within the frame above.
  </p>

  <!-- Recent Scans Section -->
  <div class="mt-8">
    <h2 class="text-xl font-bold mb-4 text-slate-800">Recent Scans</h2>

    @if (isLoading()) {
    <div class="flex justify-center p-4">
      <i class="pi pi-spin pi-spinner text-2xl text-slate-600"></i>
    </div>
    } @else if (recentScans().length === 0) {
    <div class="text-center text-slate-500 p-4">No recent scans found</div>
    } @else {
    <ul class="list-none p-0 m-0 bg-white/70 rounded-lg shadow-sm">
      @for (scan of recentScans(); track scan.id) {
      <li
        class="block border-b border-slate-200 last:border-b-0 hover:bg-slate-100/80 transition-colors"
      >
        <a
          [routerLink]="
            scan.success && scan.receiptId ? ['/receipt', scan.receiptId] : null
          "
          [class.cursor-pointer]="scan.success && scan.receiptId"
          [class.cursor-not-allowed]="!scan.success || !scan.receiptId"
          class="flex items-center py-3 px-4 w-full"
        >
          <i class="pi pi-clock text-slate-500 mr-3"></i>
          <div class="flex-grow overflow-hidden">
            <div class="font-medium text-slate-800">
              {{ formatScanDate(scan.timestamp) }}
            </div>
            <div class="text-sm text-slate-500 truncate">
              @if (typeof scan.totalAmount === 'number') {
              <span class="font-semibold">{{
                scan.totalAmount | currency : "UZS " : "symbol" : "1.0-0"
              }}</span>
              } @else {
              {{ scan.url }}
              }
            </div>
          </div>
          @if (scan.success) {
          <span class="text-green-500 ml-2">
            <i class="pi pi-check-circle"></i>
          </span>
          } @else {
          <span class="text-red-500 ml-2">
            <i class="pi pi-times-circle"></i>
          </span>
          }
        </a>
      </li>
      }
    </ul>
    }
  </div>
</div>
}
